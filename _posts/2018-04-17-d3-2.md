---
published: true
layout: post
title: "æ•°æ®å¯è§†åŒ–ï¼šD3 åŸºç¡€å…¥é—¨å­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰"
date: 2018-04-17
---

#### Scale æ¯”ä¾‹å°º

D3 çš„æ¯”ä¾‹å°ºæä¾›äº†ä¸€ç§è®¡ç®—å…³ç³»ï¼Œ å°†æŸä¸€åŒºåŸŸçš„å€¼æ˜ å°„åˆ°å¦ä¸€åŒºåŸŸï¼Œå…¶å¤§å°å…³ç³»ä¸å˜ã€‚ç±»ä¼¼æ•°å­¦ä¸­ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹çš„å®šä¹‰åŸŸå’Œå€¼åŸŸã€‚

- domain(): å®šä¹‰åŸŸï¼ŒæŒ‡å®šåŸå§‹æ•°æ®èŒƒå›´ï¼›
- range(): å€¼åŸŸï¼ŒæŒ‡å®šå±•ç¤ºæ•°æ®èŒƒå›´ï¼›

å¸¸ç”¨çš„æ¯”ä¾‹å°ºï¼š

- d3.scaleLinear() çº¿æ€§æ¯”ä¾‹å°º  
å°†ä¸€ä¸ªè¿ç»­çš„åŒºé—´ï¼Œæ˜ å°„åˆ°å¦ä¸€åŒºé—´ã€‚

```
var data = [1, 5, 8, 10, 20];
var linear = d3.scaleLinear()
  .domain([d3.min(data), d3.max(data)])
  .range([0, 100]);

linear(1);// 0
linear(20); // 100
linear(5); // 21.052631578947366
```

- d3.scaleOrdinal() åºæ•°æ¯”ä¾‹å°º  
é€‚ç”¨äºå®šä¹‰åŸŸå’Œå€¼åŸŸæ˜¯ç¦»æ•£å€¼çš„æ—¶å€™ã€‚

```
var data = [0, 1, 2, 3];
var color = ["red", "yellow", "blue", "green"];
var ordinal = d3.scaleOrdinal().domain(data).range(color);
ordinal(0); // red
ordinal(1); // yellow
```
#### Axis åæ ‡è½´

SVG ä¸­æ²¡æœ‰ç°æˆçš„åæ ‡è½´å›¾å½¢å…ƒç´ ï¼Œéœ€è¦ç”¨å…¶ä»–çš„å…ƒç´ ç»„åˆæ„æˆã€‚å¤§è‡´çš„ç»“æ„å¦‚ä¸‹ï¼š

```
<g>
	<!-- åæ ‡è½´çš„è½´çº¿ -->
	<path></path>
	<!-- ç¬¬ä¸€ä¸ªåˆ»åº¦ -->
	<g>
		<line></line> <!-- ç¬¬ä¸€ä¸ªåˆ»åº¦çš„ç›´çº¿ -->
		<text></text> <!-- ç¬¬ä¸€ä¸ªåˆ»åº¦çš„æ–‡å­— -->
	</g>
	<!-- ç¬¬äºŒä¸ªåˆ»åº¦ -->
	<g>
		<line></line> <!-- ç¬¬äºŒä¸ªåˆ»åº¦çš„ç›´çº¿ -->
		<text></text> <!-- ç¬¬äºŒä¸ªåˆ»åº¦çš„æ–‡å­— -->
	</g>
...
</g>
```
å¦‚æœæ‰‹åŠ¨ç»˜åˆ¶åæ ‡è½´çš„è¯ä¼šæ¯”è¾ƒç¹çï¼ŒD3 æä¾›äº†åæ ‡è½´ç»„ä»¶, ä»¥ä¸‹å››ä¸ªæ–¹æ³•åˆ†åˆ«ç”¨äºç”Ÿæˆä¸åŒæœå‘çš„åæ ‡è½´ï¼š

- d3.axisTop()
- d3.axisBottom()
- d3.axisLeft()
- d3.axisRight()

ç”Ÿæˆåæ ‡è½´å°±éœ€è¦ç”¨åˆ°æ¯”ä¾‹å°ºã€‚å®šä¹‰åæ ‡è½´ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```
var dataset = [ 2.5 , 2.1 , 1.7 , 1.3 , 0.9 ];

var linear = d3.scaleLinear()
  .domain([0, d3.max(dataset)])
  .range([0, 250]);

var axis = d3.axisBottom(linear) // åˆ»åº¦æ–¹å‘æœä¸‹çš„åæ ‡è½´
  .ticks(5); //æŒ‡å®šåˆ»åº¦çš„æ•°é‡
```
åœ¨SVGä¸­æ·»åŠ åæ ‡è½´ï¼š

```
svg.append("g")
  .attr("class","axisâ€) // æ·»åŠ class, æ–¹ä¾¿ä¿®æ”¹æ ·å¼
  .attr("transform","translate(20,130)â€) // ä¿®æ”¹åæ ‡è½´ä½ç½®
  .call(axis);
```
ğŸ‘†ä¸ç®¡åæ ‡è½´æœå‘å¦‚ä½•ï¼Œéƒ½æ˜¯åŸºäºç”»å¸ƒçš„åŸç‚¹ï¼ˆå³å·¦ä¸Šè§’ï¼‰ç»˜åˆ¶ï¼Œè¦æ”¹å˜åæ ‡è½´ä½ç½®çš„è¯éœ€è¦ç”¨ translate æ¥ç§»åŠ¨ä½ç½®ã€‚  
åœ¨ D3 ä¸­ï¼Œcall() çš„å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è°ƒç”¨ä¹‹åï¼Œå°†å½“å‰çš„é€‰æ‹©é›†ä½œä¸ºå‚æ•°ä¼ é€’ç»™é‡Œé¢çš„å‡½æ•°ã€‚ä¸Šé¢ç¤ºä¾‹ä¸­çš„ call() çš„å‚æ•°å°±æ˜¯å‰é¢å®šä¹‰å¥½çš„ axis åæ ‡è½´å‡½æ•°ã€‚

#### Fetch Data è·å–æ•°æ®

D3 æä¾›äº†ä¸åŒæ ¼å¼æ–‡ä»¶çš„è·å–æ–¹å¼ã€‚ç®€å•åˆ—ä¸¾å…¶ä¸­çš„å‡ ç§ï¼š

- d3.csv
- d3.tsv
- d3.dsv
- d3.json

ã€‚ã€‚ã€‚

ç¤ºä¾‹

```
d3.dsv(",", "test.csv", function(d) {
	return {
		year: new Date(+d.Year, 0, 1), // convert "Year" column to Date
		make: d.Make,
		model: d.Model,
		length: +d.Length // convert "Length" column to number
	};
}).then(function(data) {
	console.log(data);
});
```

d3.csv æ˜¯é’ˆå¯¹ä»¥é€—å·åˆ†éš”çš„ csv æ–‡ä»¶ï¼ˆcsv æ–‡ä»¶çš„å…¸å‹åˆ†éš”ç¬¦æœ‰é€—å·ã€åˆ†å·ç­‰ï¼ŒExcel è¡¨æ ¼å¯ä»¥å¦å­˜ä¸º.csvæ ¼å¼ï¼‰ï¼Œd3.dsv å’Œ d3.csv çš„åŒºåˆ«åœ¨äº, d3.dsv ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æŒ‡å®šåˆ†éš”ç¬¦ã€‚

ğŸ‘‰ D3 5.0 å¼€å§‹ä½¿ç”¨ Promise çš„å†™æ³•æ›¿ä»£ä¹‹å‰çš„å¼‚æ­¥å›è°ƒçš„å†™æ³•ï¼Œå¹¶ä¸”ä¸å‘ä¸‹å…¼å®¹ã€‚

#### è¿‡æ¸¡ Transition

- transition()
- duration()
- delay()
- ease()

ä¸Šé¢å‡ ä¸ªæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œä¸»è¦æ˜¯æ­é…ç€ä¸€èµ·ä¸ºå›¾è¡¨æ·»åŠ å„ç§è¿‡æ¸¡æ•ˆæœçš„ã€‚

### ç»¼åˆç¤ºä¾‹ - ä½¿ç”¨ D3 åšä¸€ä¸ªç®€å•çš„æŸ±å½¢å›¾

```
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>bar chart</title>
  <style>
    .bar {
      fill: #129aee;
    }
    .bar:hover {
      fill: #0d74c5;
    }
    .axis--x path {
      display: none;
    }
  </style>
</head>
<body>
  <svg width="960" height="500"></svg>
  <script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>
  <script type="text/javascript">
    var svg = d3.select("svg"),
      margin = {top: 20, right: 20, bottom: 30, left: 40},
      width = +svg.attr("width") - margin.left - margin.right,
      height = +svg.attr("height") - margin.top - margin.bottom;

    var g = svg.append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // scale
    // https://github.com/d3/d3-scale/blob/master/README.md#scaleBand
    var x = d3.scaleBand().range([0, width]).padding(0.2),
      y = d3.scaleLinear().range([height, 0]);

    d3.dsv(";", "data.csv", function(d) {
      d.frequency = + d.frequency;
      return d;
    }).then(function(data) {
      x.domain(data.map(function(d) { return d.letter; }));
      y.domain([0, d3.max(data, function(d) { return d.frequency; })]);

      // add axis-x
      g.append("g")
        .attr("class", "axis axis--x")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));

      // add axis-y
      g.append("g")
        .attr("class", "axis axis--y")
        .call(d3.axisLeft(y).ticks(10, "%"))
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 6)
        .attr("dy", "0.71em")
        .attr("text-anchor", "end")
        .style("stroke", "black")
        .text("Frequency");

      // add bar
      g.selectAll(".bar")
        .data(data)
        .enter()
        .append("rect")
        .attr("class", "bar")
        .attr("width", x.bandwidth())
        .attr("height", 0)
        .attr("x", function(d) { return x(d.letter); })
        .attr("y", height)
        .transition() // å¼€å¯è¿‡æ¸¡
        .delay(function(d, i) { return i * 100 })
        .duration(1000)
        .ease(d3.easeBounce) // å¼¹è·³æ•ˆæœ
        .attr("height", function(d) { return height - y(d.frequency)})
        .attr("y",function(d){ return y(d.frequency) });
    });
  </script>
</body>
</html>
```

ä½¿ç”¨çš„æ•°æ®ï¼š

```
letter;frequency
A;0.08167
B;0.01492
C;0.02782
D;0.04253
E;0.12702
F;0.02288
G;0.02015
H;0.06094
I;0.06966
J;0.00153
K;0.00772
L;0.04025
M;0.02406
N;0.06749
O;0.07507
P;0.01929
Q;0.00095
R;0.05987
S;0.06327
T;0.09056
U;0.02758
V;0.00978
W;0.0236
X;0.0015
Y;0.01974
Z;0.00074
```

ğŸ‘‰ ä¸Šé¢ç¤ºä¾‹çš„æ•ˆæœæ˜¯ä¸€ä¸ªæŸ±å½¢å›¾ï¼Œç”¨æ¥å±•ç¤ºè‹±æ–‡ä¸­ä¸åŒå­—æ¯çš„ä½¿ç”¨é¢‘ç‡ã€‚è¿™ä¸ªä¾‹å­å’Œä½¿ç”¨çš„æ•°æ®æºäº D3 ä½œè€… Mike Bostock çš„åšæ–‡ [Letâ€™s Make a Bar Chart, III]ã€‚  
åŸºäºä½œè€…å†™çš„ä¾‹å­ç®€å•åšäº†ä¸€ç‚¹ä¿®æ”¹ï¼Œæ¯”å¦‚ç»™æ¯ä¸ªæŸ±å½¢åŠ ä¸Šç®€å•çš„è¿‡æ¸¡æ•ˆæœã€‚

âœ¨âœ¨âœ¨ 

æ¨èä¸€ä¸‹ D3 ä½œè€…å…³äºæŸ±å½¢å›¾çš„è¿™ä¸€ç³»åˆ—æ–‡ç« ï¼Œä¸€å…±æœ‰ä¸‰ç¯‡:

- [Letâ€™s Make a Bar Chart]
- [Letâ€™s Make a Bar Chart, II]
- [Letâ€™s Make a Bar Chart, III]

[Letâ€™s Make a Bar Chart]:https://bost.ocks.org/mike/bar/
[Letâ€™s Make a Bar Chart, II]:https://bost.ocks.org/mike/bar/2/
[Letâ€™s Make a Bar Chart, III]:https://bost.ocks.org/mike/bar/3/

